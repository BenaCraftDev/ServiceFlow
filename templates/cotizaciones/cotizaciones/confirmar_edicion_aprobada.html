{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Confirmar Edici√≥n - {{ cotizacion.numero }}</title>
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
  <!-- Header -->
  <div class="topbar">
    <div class="logo">
      ‚ö†Ô∏è Confirmar Edici√≥n
      <span class="badge">{{ cotizacion.numero }}</span>
    </div>
    <div class="spacer"></div>
    <div class="user-menu">
      <a href="{% url 'cotizaciones:detalle' cotizacion.pk %}">‚Üê Volver</a>
    </div>
  </div>

  <div class="container">
    
    <!-- Alerta de advertencia -->
    <div class="alert warning" style="margin-bottom: 24px;">
      <span style="font-size: 2rem;">‚ö†Ô∏è</span>
      <div>
        <strong style="font-size: 1.1rem;">Esta cotizaci√≥n est√° APROBADA por el cliente</strong>
        <br><br>
        <p style="margin: 8px 0 0;">
          Al editarla, su estado cambiar√° a <strong>"Requiere Cambios"</strong> y deber√° ser:
        </p>
        <ul style="margin: 12px 0 0; padding-left: 20px;">
          <li>Modificada seg√∫n los cambios necesarios</li>
          <li>Enviada nuevamente al cliente para aprobaci√≥n</li>
          <li>Aprobada otra vez por el cliente</li>
        </ul>
      </div>
    </div>

    <!-- Informaci√≥n de la cotizaci√≥n -->
    <div class="card">
      <h3>üìã Informaci√≥n de la Cotizaci√≥n</h3>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">N√∫mero:</span>
          <span class="info-value"><strong>{{ cotizacion.numero }}</strong></span>
        </div>
        <div class="info-item">
          <span class="info-label">Cliente:</span>
          <span class="info-value">{{ cotizacion.get_nombre_cliente }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Estado Actual:</span>
          <span class="info-value">
            <span class="pill aprobada">{{ cotizacion.get_estado_display }}</span>
          </span>
        </div>
        <div class="info-item">
          <span class="info-label">Referencia:</span>
          <span class="info-value">{{ cotizacion.referencia|truncatewords:8 }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Valor Total:</span>
          <span class="info-value"><strong>${{ cotizacion.valor_total|floatformat:0 }}</strong></span>
        </div>
        <div class="info-item">
          <span class="info-label">Fecha Aprobaci√≥n:</span>
          <span class="info-value">
            {% if cotizacion.fecha_respuesta_cliente %}
              {{ cotizacion.fecha_respuesta_cliente|date:"d/m/Y H:i" }}
            {% else %}
              -
            {% endif %}
          </span>
        </div>
      </div>
    </div>

    <!-- Proceso de cambio -->
    <div class="card">
      <h3>üîÑ Proceso de Cambio de Estado</h3>
      <div style="display: grid; gap: 16px;">
        <div style="display: flex; gap: 12px; align-items: start;">
          <span style="font-size: 1.5rem;">1Ô∏è‚É£</span>
          <div>
            <strong>Estado actual: APROBADA</strong> <span class="pill aprobada" style="margin-left: 8px;">Aprobada</span>
            <br>
            <small style="color: var(--gris-600);">El cliente ha aprobado esta cotizaci√≥n</small>
          </div>
        </div>
        <div style="display: flex; gap: 12px; align-items: start;">
          <span style="font-size: 1.5rem;">2Ô∏è‚É£</span>
          <div>
            <strong>Nuevo estado: REQUIERE CAMBIOS</strong> <span class="pill requiere_cambios" style="margin-left: 8px;">Requiere Cambios</span>
            <br>
            <small style="color: var(--gris-600);">Permitir√° editar pero resetea el proceso de aprobaci√≥n</small>
          </div>
        </div>
        <div style="display: flex; gap: 12px; align-items: start;">
          <span style="font-size: 1.5rem;">3Ô∏è‚É£</span>
          <div>
            <strong>Edici√≥n y reenv√≠o al cliente</strong>
            <br>
            <small style="color: var(--gris-600);">Deber√°s modificar lo necesario y enviarla nuevamente</small>
          </div>
        </div>
        <div style="display: flex; gap: 12px; align-items: start;">
          <span style="font-size: 1.5rem;">4Ô∏è‚É£</span>
          <div>
            <strong>Nueva aprobaci√≥n del cliente</strong>
            <br>
            <small style="color: var(--gris-600);">El cliente deber√° aprobar los cambios realizados</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Alternativa recomendada -->
    <div class="card" style="background: var(--azul-100); border-color: var(--azul-500);">
      <h3>üí° ¬øSolo necesitas cambiar la fecha de realizaci√≥n?</h3>
      <p style="margin: 0 0 12px;">
        Si √∫nicamente necesitas actualizar la fecha programada para realizar el trabajo, 
        no es necesario editar la cotizaci√≥n completa. 
      </p>
      <a href="{% url 'cotizaciones:actualizar_fecha_realizacion' cotizacion.pk %}" class="btn" style="background: var(--azul-600);">
        üìÖ Cambiar Solo la Fecha de Realizaci√≥n
      </a>
      <p style="margin: 12px 0 0; font-size: 0.85rem; color: var(--gris-600);">
        Esta opci√≥n notifica al cliente autom√°ticamente sin cambiar el estado de la cotizaci√≥n.
      </p>
    </div>

    <!-- Formulario de confirmaci√≥n -->
    <div class="card">
      <h3>‚úÖ Confirmaci√≥n Requerida</h3>
      
      <form method="post">
        {% csrf_token %}
        
        <div style="background: var(--rojo-100); border: 2px solid var(--rojo-600); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
          <p style="margin: 0 0 12px; font-weight: 600; color: var(--rojo-600);">
            ‚ö†Ô∏è Confirmo que:
          </p>
          <ul style="margin: 0; padding-left: 20px; color: var(--negro);">
            <li>Entiendo que la cotizaci√≥n cambiar√° a "Requiere Cambios"</li>
            <li>El cliente ser√° notificado de los cambios</li>
            <li>Deber√© reenviar la cotizaci√≥n para nueva aprobaci√≥n</li>
            <li>Este cambio quedar√° registrado en el sistema</li>
          </ul>
        </div>

        <div class="actions">
          <a href="{% url 'cotizaciones:detalle' cotizacion.pk %}" class="btn secondary">
            ‚ùå Cancelar
          </a>
          <button type="submit" name="confirmar" class="btn danger">
            ‚ö†Ô∏è Confirmar y Editar
          </button>
        </div>
      </form>
    </div>
  </div>
</body>
</html>