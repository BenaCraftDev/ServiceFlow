{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Enviar CotizaciÃ³n por Email - Sistema de Cotizaciones</title>
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
  <!-- Header -->
  <div class="topbar">
    <div class="logo">
      ğŸ“§ Enviar CotizaciÃ³n
      <span class="badge">{{ cotizacion.numero }}</span>
    </div>
    <div class="spacer"></div>
    <div class="user-menu">
      <a href="{% url 'cotizaciones:detalle' cotizacion.pk %}">ğŸ‘ï¸ Ver CotizaciÃ³n</a>
      <a href="{% url 'cotizaciones:lista' %}">ğŸ“„ Lista</a>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <h3>ğŸ“§ Enviar CotizaciÃ³n por Email</h3>
      
      <!-- Info de la cotizaciÃ³n -->
      <div style="background: var(--azul-100); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="margin: 0 0 10px;">CotizaciÃ³n NÂ° {{ cotizacion.numero }}</h4>
        <p style="margin: 5px 0;"><strong>Cliente:</strong> {{ cotizacion.get_nombre_cliente }}</p>
        <p style="margin: 5px 0;"><strong>Referencia:</strong> {{ cotizacion.referencia|truncatewords:10 }}</p>
        <p style="margin: 5px 0;"><strong>Valor Total:</strong> ${{ cotizacion.valor_total|floatformat:0 }}</p>
      </div>

      <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
          <label for="email">Email del Cliente *</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            required
            value="{{ email_sugerido }}"
            placeholder="cliente@ejemplo.com">
          <small style="color: var(--gris-600);">
            El cliente recibirÃ¡ la cotizaciÃ³n y podrÃ¡ responder directamente desde el email
          </small>
        </div>

        <div class="form-group">
          <label for="mensaje_adicional">Mensaje Adicional (Opcional)</label>
          <textarea 
            id="mensaje_adicional" 
            name="mensaje_adicional" 
            rows="5"
            placeholder="Agregue un mensaje personalizado que se incluirÃ¡ en el email..."></textarea>
        </div>

        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input 
                    type="checkbox" 
                    name="enviar_copia" 
                    checked
                    style="width: auto; cursor: pointer;"
                >
                <span>Enviar copia a mi correo ({{ request.user.email }})</span>
            </label>
            <small class="muted">RecibirÃ¡s una copia del email enviado al cliente</small>
        </div>

        <!-- Preview de lo que se enviarÃ¡ -->
        <div style="background: var(--gris-100); padding: 16px; border-radius: 8px; margin-top: 20px;">
          <h4 style="margin: 0 0 10px;">âœ… El cliente recibirÃ¡:</h4>
          <ul style="margin: 10px 0; padding-left: 20px;">
            <li>âœ‰ï¸ Email con los detalles de la cotizaciÃ³n</li>
            <li>ğŸ‘ï¸ Enlace para ver la cotizaciÃ³n completa</li>
            <li>âœ… BotÃ³n para aprobar la cotizaciÃ³n</li>
            <li>ğŸ“ BotÃ³n para solicitar cambios</li>
            <li>âŒ BotÃ³n para rechazar</li>
          </ul>
          <p style="margin: 10px 0 0; color: var(--gris-600); font-size: 0.9rem;">
            <strong>Nota:</strong> Una vez enviada, recibirÃ¡s una notificaciÃ³n automÃ¡tica cuando el cliente responda.
          </p>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 30px; justify-content: flex-end;">
          <a href="{% url 'cotizaciones:detalle' cotizacion.pk %}" class="btn secondary">
            âŒ Cancelar
          </a>
          <button type="submit" class="btn success">
            ğŸ“§ Enviar CotizaciÃ³n
          </button>
        </div>
      </form>
    </div>

    <!-- InformaciÃ³n adicional -->
    <div class="card">
      <h3>â„¹ï¸ InformaciÃ³n Importante</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
        <div>
          <h4 style="color: var(--azul-600); margin: 0 0 8px;">ğŸ”’ Seguridad</h4>
          <p style="margin: 0; color: var(--gris-600); font-size: 0.9rem;">
            Se generarÃ¡ un enlace Ãºnico y seguro para que el cliente pueda responder sin necesidad de login.
          </p>
        </div>
        <div>
          <h4 style="color: var(--azul-600); margin: 0 0 8px;">ğŸ“¬ Notificaciones</h4>
          <p style="margin: 0; color: var(--gris-600); font-size: 0.9rem;">
            RecibirÃ¡s un email automÃ¡ticamente cuando el cliente apruebe, rechace o solicite cambios.
          </p>
        </div>
        <div>
          <h4 style="color: var(--azul-600); margin: 0 0 8px;">ğŸ”„ Estado</h4>
          <p style="margin: 0; color: var(--gris-600); font-size: 0.9rem;">
            La cotizaciÃ³n cambiarÃ¡ automÃ¡ticamente a "Enviada" y no podrÃ¡ ser editada hasta recibir respuesta.
          </p>
        </div>
      </div>
    </div>
  </div>
</body>
</html>